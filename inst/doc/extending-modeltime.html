<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Extending Modeltime (Developer Tools)</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>
<style type="text/css">
a.anchor-section {margin-left: 10px; visibility: hidden; color: inherit;}
a.anchor-section::before {content: '#';}
.hasAnchor:hover a.anchor-section {visibility: visible;}
</style>
<script>// Anchor sections v1.0 written by Atsushi Yasumoto on Oct 3rd, 2020.
document.addEventListener('DOMContentLoaded', function() {
  // Do nothing if AnchorJS is used
  if (typeof window.anchors === 'object' && anchors.hasOwnProperty('hasAnchorJSLink')) {
    return;
  }

  const h = document.querySelectorAll('h1, h2, h3, h4, h5, h6');

  // Do nothing if sections are already anchored
  if (Array.from(h).some(x => x.classList.contains('hasAnchor'))) {
    return null;
  }

  // Use section id when pandoc runs with --section-divs
  const section_id = function(x) {
    return ((x.classList.contains('section') || (x.tagName === 'SECTION'))
            ? x.id : '');
  };

  // Add anchors
  h.forEach(function(x) {
    const id = x.id || section_id(x.parentElement);
    if (id === '') {
      return null;
    }
    let anchor = document.createElement('a');
    anchor.href = '#' + id;
    anchor.classList = ['anchor-section'];
    x.classList.add('hasAnchor');
    x.appendChild(anchor);
  });
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Extending Modeltime (Developer Tools)</h1>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>The <code>modeltime</code> package was with extensibility in mind. It’s impossible to incorporate the entire <a href="https://CRAN.R-project.org/view=TimeSeries">R time series ecosystem</a> into a single package. More than likely your going to need something that hasn’t been included yet. And, if you’re a developer, <strong><em>I challenge you</em></strong> to extend <code>modeltime</code> to suit your needs. I’ve spent a lot of time thinking about:</p>
<ul>
<li>A <a href="https://business-science.github.io/modeltime/articles/getting-started-with-modeltime.html">systematic workflow</a> that can be used for time series analysis</li>
<li>A way to integrate time series into a <a href="https://www.tidymodels.org/">best-in-class modeling framework</a> (i.e. <code>tidymodels</code>)</li>
</ul>
<p>And, I want you to leverage what has been built so you don’t have to recreate the wheel.</p>
<div id="before-we-get-started-where-are-we-coming-from" class="section level3">
<h3>Before we get started, where are we coming from?</h3>
<p>Beyond being an amazing ecosystem for <strong><em>Machine Learning analysis in R</em></strong>, <code>tidymodels</code> is a <strong><em>developer-friendly infrastructure</em></strong> that enables <code>parsnip</code>-adjacent packages like <code>modeltime</code>. The ecosystem provides basic building blocks for extending machine learning models, tuning parameters, performance metrics, and preprocessing (feature engineering) tools. Before you start building, I highly recommend reviewing these resources:</p>
<ul>
<li><strong>Parsnip Models (Algorithms)</strong>: <a href="https://www.tidymodels.org/learn/develop/models/">How to build a parsnip model</a></li>
<li><strong>Dials Parameters (Tuning)</strong>: <a href="https://www.tidymodels.org/learn/develop/parameters/">How to create a tuning parameter function</a></li>
<li><strong>Yardstick Metrics (Performance)</strong>: <a href="https://www.tidymodels.org/learn/develop/metrics/">Custom performance metrics</a></li>
<li><strong>Recipes Step Functions (preprocessing)</strong>: <a href="https://www.tidymodels.org/learn/develop/recipes/">Create your own recipe step function</a></li>
</ul>
<p>The most important is the first resource - <em>“How to build a parsnip model”</em>.</p>
</div>
<div id="where-we-are-going" class="section level3">
<h3>Where we are going!</h3>
<p>What we’re going to do momentarily is modify the “How to build a parsnip model” article. Your learning <em>“How to build a modeltime model”</em>. There are a few key nuances:</p>
<ol style="list-style-type: decimal">
<li>Managing Date and Date-time Features</li>
<li>Processing Regressors and Dates separately</li>
</ol>
</div>
</div>
<div id="example-integrating-multiple-seasonal-decomposition" class="section level2">
<h2>Example <br><small>Integrating Multiple Seasonal Decomposition</small></h2>
<p>The <code>forecast</code> package includes the <code>stlm()</code> function for creating models using <a href="https://otexts.com/fpp2/complexseasonality.html">time series decomposition</a>. It’s a great approach based on the concept that you can decompose complex seasonality into multiple components:</p>
<ul>
<li>Trend</li>
<li>One or Multiple Seasonalities</li>
<li>Remainder</li>
</ul>
<p>We can then forecast the components using models like: <code>auto.arima()</code> and <code>ets()</code>.</p>
<p><strong>Note - I’ve added a <code>seasonal_reg()</code> function that includes the functionality we are about to create. Check that function out to see more about seasonal decomposition methods.</strong></p>
<div id="libraries" class="section level3">
<h3>Libraries</h3>
<p>To use the code in this tutorial, you’ll need to have the following packages installed.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(parsnip)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(forecast)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">library</span>(rsample)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">library</span>(modeltime)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw">library</span>(timetk)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="kw">library</span>(rlang)</span></code></pre></div>
</div>
<div id="data" class="section level3">
<h3>Data</h3>
<p>We’ll use <code>taylor_30_min</code> data from the <code>timetk</code> package, which is electricity demand data at a 30-minute interval.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>taylor_<span class="dv">30</span>_min <span class="op">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="st">  </span><span class="kw">plot_time_series</span>(date, value, <span class="dt">.interactive =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" style="display: block; margin: auto;" /></p>
</div>
<div id="stlm-model---a-quick-overview" class="section level3">
<h3>STLM Model - A quick overview</h3>
<p>We need to use 2 functions to create the model:</p>
<ul>
<li><code>msts()</code> - Tracks the multiple-seasonality as an object</li>
<li><code>stlm()</code> - Creates a model from the <code>msts</code> object.</li>
</ul>
<p>Note that we use seasonal periods (<code>24*2 = 48</code>) for daily seasonality because this series has been aggregated at a 30-minute interval. The second seasonality is at 7-days, so we just use <code>24*2*7</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>stlm_model &lt;-<span class="st"> </span>taylor_<span class="dv">30</span>_min <span class="op">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="st">  </span><span class="kw">pull</span>(value) <span class="op">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="st">  </span><span class="kw">msts</span>(<span class="dt">seasonal.periods =</span> <span class="kw">c</span>(<span class="dv">24</span><span class="op">*</span><span class="dv">2</span>, <span class="dv">24</span><span class="op">*</span><span class="dv">2</span><span class="op">*</span><span class="dv">7</span>)) <span class="op">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="st">  </span><span class="kw">stlm</span>()</span>
<span id="cb3-5"><a href="#cb3-5"></a></span>
<span id="cb3-6"><a href="#cb3-6"></a>stlm_model<span class="op">$</span>stl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">autoplot</span>()</span></code></pre></div>
<p><img src="data:image/png;base64,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" style="display: block; margin: auto;" /></p>
<p>The <code>forecast()</code> function is used to generate predictions, much like the <code>predict()</code> function.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>stlm_model <span class="op">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="st">  </span><span class="kw">forecast</span>(<span class="dt">h =</span> <span class="dv">24</span><span class="op">*</span><span class="dv">2</span><span class="op">*</span><span class="dv">7</span>) <span class="op">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="st">  </span><span class="kw">autoplot</span>()</span></code></pre></div>
<p><img src="data:image/png;base64,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" style="display: block; margin: auto;" /></p>
<p>Looks like it’s doing a pretty decent job of forecasting the Taylor 30-Min Data.</p>
</div>
</div>
<div id="how-to-build-a-modeltime-model" class="section level2">
<h2>How to build a modeltime model</h2>
<p>The first step we need to do is to think about the function. We can create:</p>
<ul>
<li><code>msts()</code>: Creates a multiple time series object. Key arguments: <code>seasonal.periods</code>.</li>
<li><code>stlm()</code>: Creates the Multiple STL Model. Key arguments:
<ul>
<li><code>method</code>: Either <code>ets</code> or <code>arima</code> (actually uses <code>auto.arima</code>)</li>
<li>We’ll handle this by creating a specific engine called “stlm_ets” for the <code>ets</code> version.</li>
</ul></li>
</ul>
<p>We could add others, but let’s keep it simple for now.</p>
</div>
<div id="the-general-process" class="section level2">
<h2>The General Process</h2>
<p>We follow a very similar process to <a href="https://www.tidymodels.org/learn/develop/models/#the-general-process"><em>“How to build a parsnip model”</em></a> with a few additional aspects:</p>
<ol style="list-style-type: decimal">
<li>We create a <strong>“Modeltime Bridge”</strong> function to bridge between <code>parsnip</code> api functions and <code>forecast</code> time series.</li>
<li>We handle feature preprocessing internally to the model bridge to avoid the issue of losing <strong>dates and date-time information.</strong></li>
</ol>
<div id="step-1-register-the-model-modes-and-arguments" class="section level3">
<h3>Step 1: Register the Model, Modes, and Arguments</h3>
<p>Let’s add a new model called <code>decomposition_reg()</code> for Regression by Decomposition. Because Time Series analysis is generally regression, we’ll just register the regression mode.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">set_new_model</span>(<span class="st">&quot;decomposition_reg&quot;</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="kw">set_model_mode</span>(<span class="dt">model =</span> <span class="st">&quot;decomposition_reg&quot;</span>, <span class="dt">mode =</span> <span class="st">&quot;regression&quot;</span>)</span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="kw">set_model_engine</span>(<span class="dt">model =</span> <span class="st">&quot;decomposition_reg&quot;</span>, <span class="dt">mode =</span> <span class="st">&quot;regression&quot;</span>, <span class="dt">eng =</span> <span class="st">&quot;stlm_ets&quot;</span>)</span>
<span id="cb5-4"><a href="#cb5-4"></a></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co"># Here we set the dependency to forecast, though we can also use</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co"># your package if you import the lower level package</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="kw">set_dependency</span>(<span class="dt">model =</span> <span class="st">&quot;decomposition_reg&quot;</span>, <span class="dt">eng =</span> <span class="st">&quot;stlm_ets&quot;</span>, <span class="dt">pkg =</span> <span class="st">&quot;forecast&quot;</span>)</span></code></pre></div>
<p>We can use <code>show_model_info()</code> to see what’s been added to the registered model.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">show_model_info</span>(<span class="st">&quot;decomposition_reg&quot;</span>)</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co">#&gt; Information for `decomposition_reg`</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co">#&gt;  modes: unknown, regression </span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co">#&gt; </span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co">#&gt;  engines: </span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co">#&gt;    regression: stlm_ets</span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co">#&gt; </span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">#&gt;  no registered arguments.</span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co">#&gt; </span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co">#&gt;  no registered fit modules.</span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co">#&gt; </span></span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="co">#&gt;  no registered prediction modules.</span></span></code></pre></div>
<p>We need to add model arguments as well. We’ll use <code>set_model_args()</code> to add the appropriate model arguments.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># 1st Frequency (period_seasonal_1 is a non-jargony term)</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw">set_model_arg</span>(</span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="dt">model        =</span> <span class="st">&quot;decomposition_reg&quot;</span>, </span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="dt">eng          =</span> <span class="st">&quot;stlm_ets&quot;</span>, </span>
<span id="cb7-5"><a href="#cb7-5"></a>  <span class="dt">parsnip      =</span> <span class="st">&quot;period_seasonal_1&quot;</span>, </span>
<span id="cb7-6"><a href="#cb7-6"></a>  <span class="dt">original     =</span> <span class="st">&quot;period_seasonal_1&quot;</span>, </span>
<span id="cb7-7"><a href="#cb7-7"></a>  <span class="dt">func         =</span> <span class="kw">list</span>(<span class="dt">pkg =</span> <span class="st">&quot;foo&quot;</span>, <span class="dt">fun =</span> <span class="st">&quot;bar&quot;</span>),</span>
<span id="cb7-8"><a href="#cb7-8"></a>  <span class="dt">has_submodel =</span> <span class="ot">FALSE</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>)</span>
<span id="cb7-10"><a href="#cb7-10"></a></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="co"># 2nd Frequency (period_seasonal_2 is a non-jargony term)</span></span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="kw">set_model_arg</span>(</span>
<span id="cb7-13"><a href="#cb7-13"></a>  <span class="dt">model        =</span> <span class="st">&quot;decomposition_reg&quot;</span>, </span>
<span id="cb7-14"><a href="#cb7-14"></a>  <span class="dt">eng          =</span> <span class="st">&quot;stlm_ets&quot;</span>, </span>
<span id="cb7-15"><a href="#cb7-15"></a>  <span class="dt">parsnip      =</span> <span class="st">&quot;period_seasonal_2&quot;</span>, </span>
<span id="cb7-16"><a href="#cb7-16"></a>  <span class="dt">original     =</span> <span class="st">&quot;period_seasonal_2&quot;</span>, </span>
<span id="cb7-17"><a href="#cb7-17"></a>  <span class="dt">func         =</span> <span class="kw">list</span>(<span class="dt">pkg =</span> <span class="st">&quot;foo&quot;</span>, <span class="dt">fun =</span> <span class="st">&quot;bar&quot;</span>),</span>
<span id="cb7-18"><a href="#cb7-18"></a>  <span class="dt">has_submodel =</span> <span class="ot">FALSE</span></span>
<span id="cb7-19"><a href="#cb7-19"></a>)</span></code></pre></div>
<p><strong>Important note</strong>: We are going to map these “modeltime” arguments to a lower-level bridge function, so we don’t need <code>original = seasonal.periods</code>. In fact, we can’t do this because you need to have a one-to-one relationship between your parsnip/modeltime model arguments and the lower-level modeling function.</p>
</div>
<div id="step-2-create-the-model-function" class="section level3">
<h3>Step 2: Create the model function</h3>
<p>We’ll create a <code>decomposition_reg()</code> function that will be our core <code>parsnip</code> function.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>decomposition_reg &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">mode =</span> <span class="st">&quot;regression&quot;</span>, </span>
<span id="cb8-2"><a href="#cb8-2"></a>                              <span class="dt">period_seasonal_1 =</span> <span class="ot">NULL</span>, </span>
<span id="cb8-3"><a href="#cb8-3"></a>                              <span class="dt">period_seasonal_2 =</span> <span class="ot">NULL</span>) {</span>
<span id="cb8-4"><a href="#cb8-4"></a></span>
<span id="cb8-5"><a href="#cb8-5"></a>    args &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb8-6"><a href="#cb8-6"></a>        <span class="dt">period_seasonal_1 =</span> rlang<span class="op">::</span><span class="kw">enquo</span>(period_seasonal_<span class="dv">1</span>),</span>
<span id="cb8-7"><a href="#cb8-7"></a>        <span class="dt">period_seasonal_2 =</span> rlang<span class="op">::</span><span class="kw">enquo</span>(period_seasonal_<span class="dv">2</span>)</span>
<span id="cb8-8"><a href="#cb8-8"></a>    )</span>
<span id="cb8-9"><a href="#cb8-9"></a></span>
<span id="cb8-10"><a href="#cb8-10"></a>    parsnip<span class="op">::</span><span class="kw">new_model_spec</span>(</span>
<span id="cb8-11"><a href="#cb8-11"></a>        <span class="st">&quot;decomposition_reg&quot;</span>,</span>
<span id="cb8-12"><a href="#cb8-12"></a>        <span class="dt">args     =</span> args,</span>
<span id="cb8-13"><a href="#cb8-13"></a>        <span class="dt">eng_args =</span> <span class="ot">NULL</span>,</span>
<span id="cb8-14"><a href="#cb8-14"></a>        <span class="dt">mode     =</span> mode,</span>
<span id="cb8-15"><a href="#cb8-15"></a>        <span class="dt">method   =</span> <span class="ot">NULL</span>,</span>
<span id="cb8-16"><a href="#cb8-16"></a>        <span class="dt">engine   =</span> <span class="ot">NULL</span></span>
<span id="cb8-17"><a href="#cb8-17"></a>    )</span>
<span id="cb8-18"><a href="#cb8-18"></a></span>
<span id="cb8-19"><a href="#cb8-19"></a>}</span></code></pre></div>
</div>
<div id="step-3-add-a-fit-bridge-module" class="section level3">
<h3>Step 3: Add a Fit Bridge &amp; Module</h3>
<p>For Time Series models, we need to do extra work to get them to fit the <code>parsnip</code> mold. The easiest way is to create a <strong>“Bridge” function</strong> that helps process the data and connect the arguments with the underlying time series package.</p>
<div id="step-3a-create-the-fit-bridge" class="section level4">
<h4>Step 3A: Create the Fit Bridge</h4>
<p><strong>Time Series Developer Tools</strong> come included with <code>modeltime</code>:</p>
<ul>
<li><strong>Bridge Constructor</strong>: <code>new_modeltime_bridge()</code>, A constructor for creating <code>modeltime</code> bridges that provide the connection between time series models and the <code>parsnip</code> infrastructure.</li>
<li><strong>Xreg Preprocessing Tools</strong>: <code>create_xreg_recipe()</code>, <code>juice_xreg_recipe()</code>, and <code>bake_xreg_recipe()</code></li>
<li><strong>Date and Date-Time Parsing Tools</strong>: <code>parse_index_from_data()</code>, <code>parse_period_from_index()</code></li>
</ul>
<p>Here’s a sample bridge function. It:</p>
<ol style="list-style-type: decimal">
<li>Handles the data inputs, <code>x</code> (data.frame of predictors) and <code>y</code> (vector, target)</li>
<li>Handles the timestamp data (index) - This column is parsed from <code>x</code></li>
<li>Handles the Predictors - formatting as necessary. The <code>ets()</code> model is univariate, so no predictors are necessary to be transformed.<br />
</li>
<li>Handles Fitting the model</li>
<li>Creates a new model bridge using the constructor, <code>new_modeltime_bridge()</code></li>
</ol>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>bridge_stlm_ets_fit_impl &lt;-<span class="st"> </span><span class="cf">function</span>(x, y, <span class="dt">period_seasonal_1 =</span> <span class="ot">NULL</span>, <span class="dt">period_seasonal_2 =</span> <span class="ot">NULL</span>, ...) {</span>
<span id="cb9-2"><a href="#cb9-2"></a>  </span>
<span id="cb9-3"><a href="#cb9-3"></a>  outcome    &lt;-<span class="st"> </span>y <span class="co"># Comes in as a vector</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>  predictors &lt;-<span class="st"> </span>x <span class="co"># Comes in as a data.frame (dates and possible xregs)</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>  </span>
<span id="cb9-6"><a href="#cb9-6"></a>  <span class="co"># 1. Create outcome msts object by mapping `period_seasonal` args to msts()</span></span>
<span id="cb9-7"><a href="#cb9-7"></a>  <span class="cf">if</span> (<span class="kw">is.null</span>(period_seasonal_<span class="dv">1</span>) <span class="op">||</span><span class="st"> </span>period_seasonal_<span class="dv">1</span> <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1</span>) {</span>
<span id="cb9-8"><a href="#cb9-8"></a>    <span class="kw">stop</span>(<span class="st">&quot;&#39;period_seasonal_1&#39; must be greater than 1 to assess seasonality&quot;</span>)</span>
<span id="cb9-9"><a href="#cb9-9"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">is.null</span>(period_seasonal_<span class="dv">2</span>) <span class="op">||</span><span class="st"> </span>period_seasonal_<span class="dv">2</span> <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1</span>) {</span>
<span id="cb9-10"><a href="#cb9-10"></a>    seasonal.periods &lt;-<span class="st"> </span>period_seasonal_<span class="dv">1</span></span>
<span id="cb9-11"><a href="#cb9-11"></a>  } <span class="cf">else</span> {</span>
<span id="cb9-12"><a href="#cb9-12"></a>    seasonal.periods &lt;-<span class="st"> </span><span class="kw">c</span>(period_seasonal_<span class="dv">1</span>, period_seasonal_<span class="dv">2</span>)</span>
<span id="cb9-13"><a href="#cb9-13"></a>  }</span>
<span id="cb9-14"><a href="#cb9-14"></a>  outcome_msts &lt;-<span class="st"> </span>forecast<span class="op">::</span><span class="kw">msts</span>(outcome, <span class="dt">seasonal.periods =</span> seasonal.periods)</span>
<span id="cb9-15"><a href="#cb9-15"></a>  </span>
<span id="cb9-16"><a href="#cb9-16"></a>  <span class="co"># 2. Predictors - Handle Dates </span></span>
<span id="cb9-17"><a href="#cb9-17"></a>  index_tbl &lt;-<span class="st"> </span>modeltime<span class="op">::</span><span class="kw">parse_index_from_data</span>(predictors)</span>
<span id="cb9-18"><a href="#cb9-18"></a>  idx_col   &lt;-<span class="st"> </span><span class="kw">names</span>(index_tbl)</span>
<span id="cb9-19"><a href="#cb9-19"></a>  idx       &lt;-<span class="st"> </span>timetk<span class="op">::</span><span class="kw">tk_index</span>(index_tbl)</span>
<span id="cb9-20"><a href="#cb9-20"></a>  </span>
<span id="cb9-21"><a href="#cb9-21"></a>  <span class="co"># 3. Predictors - Handle Xregs</span></span>
<span id="cb9-22"><a href="#cb9-22"></a>  <span class="co"># NOT REQUIRED - ETS is univariate</span></span>
<span id="cb9-23"><a href="#cb9-23"></a>  <span class="co"># REQUIRED FOR ARIMA - ARIMA can accept XRegs</span></span>
<span id="cb9-24"><a href="#cb9-24"></a>  <span class="co"># xreg_recipe &lt;- create_xreg_recipe(predictor, prepare = TRUE)</span></span>
<span id="cb9-25"><a href="#cb9-25"></a>  <span class="co"># xreg_matrix &lt;- juice_xreg_recipe(xreg_recipe, format = &quot;matrix&quot;)</span></span>
<span id="cb9-26"><a href="#cb9-26"></a>  </span>
<span id="cb9-27"><a href="#cb9-27"></a>  <span class="co"># 4. Fitting</span></span>
<span id="cb9-28"><a href="#cb9-28"></a>  model_<span class="dv">1</span> &lt;-<span class="st"> </span>forecast<span class="op">::</span><span class="kw">stlm</span>(<span class="dt">y =</span> outcome_msts, <span class="dt">method =</span> <span class="st">&quot;ets&quot;</span>, ...)</span>
<span id="cb9-29"><a href="#cb9-29"></a>  </span>
<span id="cb9-30"><a href="#cb9-30"></a>  <span class="co"># 5. New Modeltime Bridge</span></span>
<span id="cb9-31"><a href="#cb9-31"></a>  <span class="kw">new_modeltime_bridge</span>(</span>
<span id="cb9-32"><a href="#cb9-32"></a>    <span class="dt">class  =</span> <span class="st">&quot;bridge_stlm_ets_fit_impl&quot;</span>,</span>
<span id="cb9-33"><a href="#cb9-33"></a>    <span class="dt">models =</span> <span class="kw">list</span>(<span class="dt">model_1 =</span> model_<span class="dv">1</span>),</span>
<span id="cb9-34"><a href="#cb9-34"></a>    <span class="dt">data   =</span> tibble<span class="op">::</span><span class="kw">tibble</span>(</span>
<span id="cb9-35"><a href="#cb9-35"></a>      <span class="dt">idx_col   :=</span> idx,</span>
<span id="cb9-36"><a href="#cb9-36"></a>      <span class="dt">.actual    =</span> y,</span>
<span id="cb9-37"><a href="#cb9-37"></a>      <span class="dt">.fitted    =</span> model_<span class="dv">1</span><span class="op">$</span>fitted,</span>
<span id="cb9-38"><a href="#cb9-38"></a>      <span class="dt">.residuals =</span> model_<span class="dv">1</span><span class="op">$</span>residuals</span>
<span id="cb9-39"><a href="#cb9-39"></a>    ),</span>
<span id="cb9-40"><a href="#cb9-40"></a>    <span class="dt">extras =</span> <span class="kw">list</span>(<span class="ot">NULL</span>), <span class="co"># Can add xreg preprocessors here</span></span>
<span id="cb9-41"><a href="#cb9-41"></a>    <span class="dt">desc   =</span> stringr<span class="op">::</span><span class="kw">str_c</span>(<span class="st">&quot;STLM Model: &quot;</span>, model_<span class="dv">1</span><span class="op">$</span>model<span class="op">$</span>method)</span>
<span id="cb9-42"><a href="#cb9-42"></a>  )</span>
<span id="cb9-43"><a href="#cb9-43"></a>  </span>
<span id="cb9-44"><a href="#cb9-44"></a>}</span></code></pre></div>
<p>We’ll make a quick print method so we don’t get crazy output.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>print.bridge_stlm_ets_fit_impl &lt;-<span class="st"> </span><span class="cf">function</span>(x, ...) {</span>
<span id="cb10-2"><a href="#cb10-2"></a>  </span>
<span id="cb10-3"><a href="#cb10-3"></a>  model &lt;-<span class="st"> </span>x<span class="op">$</span>models<span class="op">$</span>model_<span class="dv">1</span><span class="op">$</span>model</span>
<span id="cb10-4"><a href="#cb10-4"></a>  </span>
<span id="cb10-5"><a href="#cb10-5"></a>  <span class="kw">cat</span>(x<span class="op">$</span>desc)</span>
<span id="cb10-6"><a href="#cb10-6"></a>  <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb10-7"><a href="#cb10-7"></a>  <span class="kw">print</span>(model<span class="op">$</span>call)</span>
<span id="cb10-8"><a href="#cb10-8"></a>  <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb10-9"><a href="#cb10-9"></a>  <span class="kw">print</span>(</span>
<span id="cb10-10"><a href="#cb10-10"></a>    <span class="kw">tibble</span>(</span>
<span id="cb10-11"><a href="#cb10-11"></a>      <span class="dt">aic    =</span> model<span class="op">$</span>aic,</span>
<span id="cb10-12"><a href="#cb10-12"></a>      <span class="dt">bic    =</span> model<span class="op">$</span>bic,</span>
<span id="cb10-13"><a href="#cb10-13"></a>      <span class="dt">aicc   =</span> model<span class="op">$</span>aicc,</span>
<span id="cb10-14"><a href="#cb10-14"></a>      <span class="dt">loglik =</span> model<span class="op">$</span>loglik,</span>
<span id="cb10-15"><a href="#cb10-15"></a>      <span class="dt">mse    =</span> model<span class="op">$</span>mse  </span>
<span id="cb10-16"><a href="#cb10-16"></a>    )</span>
<span id="cb10-17"><a href="#cb10-17"></a>  )</span>
<span id="cb10-18"><a href="#cb10-18"></a>  <span class="kw">invisible</span>(x)</span>
<span id="cb10-19"><a href="#cb10-19"></a>}</span></code></pre></div>
<p>Let’s make sure our bridge works.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>stlm_test &lt;-<span class="st"> </span><span class="kw">bridge_stlm_ets_fit_impl</span>(</span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="dt">x =</span> taylor_<span class="dv">30</span>_min[,<span class="st">&quot;date&quot;</span>],</span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="dt">y =</span> taylor_<span class="dv">30</span>_min <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(value),</span>
<span id="cb11-4"><a href="#cb11-4"></a>  <span class="dt">period_seasonal_1 =</span> <span class="dv">24</span><span class="op">*</span><span class="dv">2</span>,</span>
<span id="cb11-5"><a href="#cb11-5"></a>  <span class="dt">period_seasonal_2 =</span> <span class="dv">24</span><span class="op">*</span><span class="dv">2</span><span class="op">*</span><span class="dv">7</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>)</span>
<span id="cb11-7"><a href="#cb11-7"></a></span>
<span id="cb11-8"><a href="#cb11-8"></a>stlm_test</span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="co">#&gt; STLM Model: ETS(M,N,N)</span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="co">#&gt; ets(y = x, model = etsmodel, allow.multiplicative.trend = allow.multiplicative.trend)</span></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="co">#&gt; </span></span>
<span id="cb11-12"><a href="#cb11-12"></a><span class="co">#&gt; # A tibble: 1 x 5</span></span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="co">#&gt;      aic    bic   aicc  loglik   mse</span></span>
<span id="cb11-14"><a href="#cb11-14"></a><span class="co">#&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb11-15"><a href="#cb11-15"></a><span class="co">#&gt; 1 70492. 70510. 70492. -35243. 9733.</span></span></code></pre></div>
<p>The bridge looks good.</p>
</div>
<div id="step-3b-create-a-fit-module" class="section level4">
<h4>Step 3B: Create a Fit Module</h4>
<p>Next, let’s hook up our <code>parsnip</code> fit module to the newly created bridge fit function.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">set_fit</span>(</span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="dt">model  =</span> <span class="st">&quot;decomposition_reg&quot;</span>,</span>
<span id="cb12-3"><a href="#cb12-3"></a>  <span class="dt">eng    =</span> <span class="st">&quot;stlm_ets&quot;</span>,</span>
<span id="cb12-4"><a href="#cb12-4"></a>  <span class="dt">mode   =</span> <span class="st">&quot;regression&quot;</span>,</span>
<span id="cb12-5"><a href="#cb12-5"></a>  <span class="dt">value  =</span> <span class="kw">list</span>(</span>
<span id="cb12-6"><a href="#cb12-6"></a>    <span class="dt">interface =</span> <span class="st">&quot;data.frame&quot;</span>,</span>
<span id="cb12-7"><a href="#cb12-7"></a>    <span class="dt">protect   =</span> <span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>),</span>
<span id="cb12-8"><a href="#cb12-8"></a>    <span class="dt">func      =</span> <span class="kw">c</span>(<span class="dt">fun =</span> <span class="st">&quot;bridge_stlm_ets_fit_impl&quot;</span>),</span>
<span id="cb12-9"><a href="#cb12-9"></a>    <span class="dt">defaults  =</span> <span class="kw">list</span>()</span>
<span id="cb12-10"><a href="#cb12-10"></a>  )</span>
<span id="cb12-11"><a href="#cb12-11"></a>)</span>
<span id="cb12-12"><a href="#cb12-12"></a></span>
<span id="cb12-13"><a href="#cb12-13"></a><span class="kw">show_model_info</span>(<span class="st">&quot;decomposition_reg&quot;</span>)</span>
<span id="cb12-14"><a href="#cb12-14"></a><span class="co">#&gt; Information for `decomposition_reg`</span></span>
<span id="cb12-15"><a href="#cb12-15"></a><span class="co">#&gt;  modes: unknown, regression </span></span>
<span id="cb12-16"><a href="#cb12-16"></a><span class="co">#&gt; </span></span>
<span id="cb12-17"><a href="#cb12-17"></a><span class="co">#&gt;  engines: </span></span>
<span id="cb12-18"><a href="#cb12-18"></a><span class="co">#&gt;    regression: stlm_ets</span></span>
<span id="cb12-19"><a href="#cb12-19"></a><span class="co">#&gt; </span></span>
<span id="cb12-20"><a href="#cb12-20"></a><span class="co">#&gt;  arguments: </span></span>
<span id="cb12-21"><a href="#cb12-21"></a><span class="co">#&gt;    stlm_ets: </span></span>
<span id="cb12-22"><a href="#cb12-22"></a><span class="co">#&gt;       period_seasonal_1 --&gt; period_seasonal_1</span></span>
<span id="cb12-23"><a href="#cb12-23"></a><span class="co">#&gt;       period_seasonal_2 --&gt; period_seasonal_2</span></span>
<span id="cb12-24"><a href="#cb12-24"></a><span class="co">#&gt; </span></span>
<span id="cb12-25"><a href="#cb12-25"></a><span class="co">#&gt;  fit modules:</span></span>
<span id="cb12-26"><a href="#cb12-26"></a><span class="co">#&gt;      engine       mode</span></span>
<span id="cb12-27"><a href="#cb12-27"></a><span class="co">#&gt;    stlm_ets regression</span></span>
<span id="cb12-28"><a href="#cb12-28"></a><span class="co">#&gt; </span></span>
<span id="cb12-29"><a href="#cb12-29"></a><span class="co">#&gt;  no registered prediction modules.</span></span></code></pre></div>
</div>
</div>
<div id="step-4-add-a-prediction-bridge-module" class="section level3">
<h3>Step 4: Add a Prediction Bridge &amp; Module</h3>
<p>Next, we have an additional step to bridge the prediction. We create a predict method that handles the <code>new_data</code>, treating the number of rows as the forecasting horizon.</p>
<div id="step-4a-create-a-prediction-bridge" class="section level4">
<h4>Step 4A: Create a Prediction Bridge</h4>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>predict.bridge_stlm_ets_fit_impl &lt;-<span class="st"> </span><span class="cf">function</span>(object, new_data, ...) {</span>
<span id="cb13-2"><a href="#cb13-2"></a></span>
<span id="cb13-3"><a href="#cb13-3"></a>    <span class="co"># PREPARE INPUTS</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>    model       &lt;-<span class="st"> </span>object<span class="op">$</span>models<span class="op">$</span>model_<span class="dv">1</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>    h_horizon   &lt;-<span class="st"> </span><span class="kw">nrow</span>(new_data)</span>
<span id="cb13-6"><a href="#cb13-6"></a></span>
<span id="cb13-7"><a href="#cb13-7"></a>    <span class="co"># XREG</span></span>
<span id="cb13-8"><a href="#cb13-8"></a>    <span class="co"># NOT REQUIRED FOR ETS. </span></span>
<span id="cb13-9"><a href="#cb13-9"></a>    <span class="co"># xreg_recipe &lt;- object$extras$xreg_recipe </span></span>
<span id="cb13-10"><a href="#cb13-10"></a>    <span class="co"># xreg_matrix &lt;- bake_xreg_recipe(xreg_recipe, new_data, format = &quot;matrix&quot;)</span></span>
<span id="cb13-11"><a href="#cb13-11"></a></span>
<span id="cb13-12"><a href="#cb13-12"></a>    <span class="co"># PREDICTIONS</span></span>
<span id="cb13-13"><a href="#cb13-13"></a>    preds_forecast &lt;-<span class="st"> </span>forecast<span class="op">::</span><span class="kw">forecast</span>(model, <span class="dt">h =</span> h_horizon)</span>
<span id="cb13-14"><a href="#cb13-14"></a>    </span>
<span id="cb13-15"><a href="#cb13-15"></a>    <span class="co"># Return predictions as numeric vector</span></span>
<span id="cb13-16"><a href="#cb13-16"></a>    preds &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(preds_forecast<span class="op">$</span>mean)</span>
<span id="cb13-17"><a href="#cb13-17"></a></span>
<span id="cb13-18"><a href="#cb13-18"></a>    <span class="kw">return</span>(preds)</span>
<span id="cb13-19"><a href="#cb13-19"></a></span>
<span id="cb13-20"><a href="#cb13-20"></a>}</span></code></pre></div>
<p>Let’s test the <code>predict()</code> method out. To help, I’ll leverage <code>future_frame()</code> to predict the next 3-hours worth of forecast points.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>stlm_test <span class="op">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="st">  </span><span class="kw">predict</span>(<span class="dt">new_data =</span> taylor_<span class="dv">30</span>_min <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">future_frame</span>(<span class="dt">.length_out =</span> <span class="st">&quot;1 week&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="st">  </span><span class="kw">plot</span>()</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAeAAAAGACAMAAABC/kH9AAAAXVBMVEUAAAAAADoAAGYAOpAAZrY6AAA6ADo6AGY6Ojo6OpA6kNtmAABmADpmZmZmtrZmtv+QOgCQkGaQ2/+2ZgC2/7a2///bkDrb2//b/9vb////tmb/25D//7b//9v////zR5gQAAAACXBIWXMAAA7DAAAOwwHHb6hkAAATsklEQVR4nO2diXrcug1GmcT3trXbxs0002Zi8/0f844WLpK4ABQhkRD+L5lMLBCUdEgCpBYrLWItdfYOiGglgJlLADOXAGYuAcxcApi5BDBzCWDmEsDMJYCZSwAzlwBmLgHMXAKYuQQwcwlg5hLAzCWAmUsAM5cAZi4BzFwCmLkEMHMJYOYSwMwlgJlLADOXAGYuAcxcApi5BDBzCWDmEsDMJYCZSwAzlwBmLgHMXAKYuQQwcwlg5hLAzCWAmUsAM5cAZi4BzFwCmLkEMHMJYOYSwMwlgJlLADOXAGYuAcxcApi5BDBzCWDmEsDMJYCZSwAzlwBmLgHMXAKYuQQwcwlg5hLAzCWAmUsAM5cAZi4BzFwCmLkEMHMJYOYSwMwlgJlLADOXAGYuAcxclQEr0UE6C3Bdd6KYBDBzCWDmEsDM1TRgRIogiqhlwAPfhghjUtJ21DDgiS/hOcUBG4w7JNwu4PGEYk4ptofhBojJe3+EmwU8nlDURB15/tX4F+Fe4dpbI2oY8PQHWi+2hyHtDV8BXMnd3H0VuGJsD8PZY5vbXEMDzaFdwGYhVWlIOoTtYa4BAc3n/UEF7RZG9EYBT8On8jpxuoAyIRtavTGHFfCMsWM60JxMbQKeTqaFkL8sYjMyZf6Xqd5mcMAJufKKwPw3ErObBeywztPhVAlvwAV2eN8+y8HujsYMKLhJAJVaBTyfU3uukhCWPUxlK/DHcwAw1229URfivwG+7QK2Xcad2YS538PyI7qxtx0yba8WKYGC+F+1thPVJGDl92F7QqNFvIg9wciM6MbeB5G0t81B2zLQiHE64VYBaxsd82fUpDN+7wLZuwCcznddrPb4Jv27/EoARzcawNp1h6j5qoelB0fP3su18lHYH3sB/gVweqs5pYDp6qaH6XQRk20r7fo9eL4EAqxNkzmbb6OAvZw5n9LoVQ/Lx0ibQbtkF5jvKju9TXZ48ze74/RqFPDKErpkABrRV/agFuSXAPj3EqyzCbcPGLVIaEZduOvsJEkv5+CI1tBEED4YMLrH+JUn5knK+wof0U2HzLSIZetC9PYWBukOerDOAV4AcFEy6c0P8RkOocrT3OwI3cAYzQDwamN2RF/auysIiMrT4OzW/PyLXm0C3nSQ1BndAsh3+GWDQNkj/M/DQ8TuGDUJOIAzMSbuBJy13+4OGHADQbhFwNjsEwkAbb9pXeAGNK+5nCkOgHEjeoH91kHS3m0tmTFUVjeAcecJPQ+ram+3NpBHtwg4GIPr78IBsiui5+16k4DDY2h7hPPgbJp12q63CThijlwzRlVg7i9A2ANWyPGL3bXVE+BYTho4e0VZU6xQ1D+gFncBE7E3NdUJYG3ZgmB6OWzI1+annudtgZj/2P6s60JeAKmsXgDb4TkMZ+XPAA6e/wSwUIuI+o8CXl180phb7KurG8DRE4oFkLAPDrmJBqTNOL3Z6BPO3gFCqiYBR1KScI8Mz5o1CrAfg+H24Y65treD9DlqEXA4d4kmo+F+hxrStb1TI9KFQ/7tZ8b/uatZDQKOEIgXip0+eAxOVRz3H9mbjZdTFyt7ARw7+XEvkZxJR0549jIyxMm0JeBF5sGbTTsBY1g5e9TtOFH/4WmYJFmLbbDImXGPaw909ujhp6JaBBzNXVoBJoAp3KHCWBEwzFI0yl4Aw4pgCSNjMGrFGGcvMRhUAke47BI+/HxEJ8I19qaeugHsPesJLoJaYSjL06FLkKcR7gew4Us0iuLDsFn3gpQ4b4zuCLBZ0oXGPQwAbVZGEGHVPkEOMXafB6sbwHOHBBNwdIH2uDDsxQsBXMWdu3YDBIBrEPMADd41hww6QgvgbAHMvS8KGYOtezhgzL1WEoOBBVBrC5gs2g0OmwKxKxamx8P8SxYNKYGZIxVc5QuWidRbcivdGZT7AZy47Bv8eXRKFb2GGAQWC5/oaXPkjiBqdQQ44SnUw2LVIO3xgGO3ncQvUFOKCPDn+xQAv/6s4i6hamAqNZRIHNd+mD9SNIDv6nX68jBfdrlLibjnJWJ/ZKgP+lfW/uguTAL4891ivX/7tdtdUtV6ZLyGnbdk2f9PQZ4D4I+37+brIzJIk8dgfI+stzuxMfqMZ1ha7MHITCRpHpr30I6S8WkVqxg8d+GSGFzzNKB9FV5GBrk45f5ooiz6423KoiP9N+UuHSRrBMRMAWwFQPszxmfd4jw4CQUJAAuY0B537bKe+gLcEDCkvQnAXADvWehI9FLqIVcAA7VvoSP9VAjlJJYuBs8DNJOlSrqFDvKJRoUsOmJ40uWG3hY6Tn1Sb5fcA62xzTTVVjfUxy5V9iIXgmPLbjSEG1zo4Kk0YNA7mYrrrWs4asdCB1NNo3NkJmzuCSY4K+3Ng7lq7Lzxu0+obgcQwIcpMftT7k/1Wqsbjjrujg4OWv6uvdq+axsOOvCODg6al0D6icEyTULKRuBOenB8oUNZIdyxl5dfVT8v1+vBmca12UzfGNXms7rzmoaDjlzoQALLLAdvNueWjyvcX9QhYMKFjp3AMqdxszl32guuR27M5zoqXImIPHkDK7uv6lruiIHttk936Yi3+aB2pyahJtIZ4MOBoQEn+2HMm7uQuOc0B2/L7WyhgxgAOgYj9ye5dXcQnnb1EMBkCx37gVXOogtCRhH9YIHlns1Xm48ATDhN2g+sstZn2ftE7g4W8LZtHRaDKR9daX2NZEcgxRXdLBiF07QGe3DrCDPasfubKWDyoRy9vjoRbCBUMbh8oWNvLslH6YQ88CrF0BowURZdvtCxO5fsUBYLYMh1WwNJc6BJEAEud3dBwBbLkk/6aUQTgnMpvAA+XfaIV4cenvZ4WzfXF48G/FDqyw+0u8vF4Bjg8MKF27aNuAcCvin1+vsfv/wJE9hd51k0WnHAiSdOwwPdYTH49kyubmPvbe968MmKXPCZY7C97p9bnA521sOy6LHf/v5zAEz/jo6+FJ6r+lm0Wv0bc7S5zzbcHIgAD7Pfz/9p6cErpVNIszUVfK2pcr085ZpoocP02wn1Xnd8BAKsTAaVWbdePst2KGB9n9Lnh4rkWAI4sVWZl13Hx+gjAN+j13qL3DUj2iQ+PQk0Y7P7N/ZC1fFjAfjIGHy8u1RNtM/4V32rl5kZuXuLY/OkqXvrxVYVeoCNPWAksPQYut8/xJt9jiUB2Ebq3N5wB4wFRm0P8GZeaZn8rS7KLGQutgb2pj/AuCGxV8Aui46P0NsOywFwY0NuDcCuySobhR3mRK2byhkApo+R1ElZ0oPBqh3lWJEQYAYxGN9jDr7rDl/e+/QezpuTqGSZUIftPYuuG/Na0BKwXqBN3M8RjMFR9+D9qKajYvBukV+8XPXgKQ6bWVB8Kctm0aY3R+J1d4C3t3vjXB0eYnFVmBmw90B4qnqzPXD/jmcB3o2KqjmxwE6bDk6S85V4bW4Ze3PVm+3KJGZb084BYwFQ21fJudxgCwRs+IbqFsBV7QEjRK4F+ENttHoTgld5twAmAIb0j2sBEWv7Y7MgbcfoyB4B1CZg6hiMHXKzgNEtMg7NJVeGsAoU6B0wdRaNVHXAGSd+yh2+T697wI0JMq+pCVjpRXa1dS+AKyubQ+kKWblzskqfBfD5wgf1eBbt5s0dASZfG8yppagOycoXN261H4PRaW6+KtrFyfo7vHKecb+a/raeRVdJQjYeq85k99njBPGebsDsAVMDowUcaZ6IQalDwJWXHg62xyq2/AitsTXA+Z0nHnKPj8HoJA11SM0Bzh0vObCjs2h8A+kcMKjg7qWCZlQwxAvgnlRyPF3HYFDJrvkuR5SiBttxFg0p2vSQm9W6gRI32A4BH6rqrWnbY4+4gFnT8BR3VKrfvY7OIQ4GnLh5qNghoT0BDfw0b/8srK7hoe6IVyUo5mQFu7BnGt834ObWISE4UF1y9x4I4GwB0h5f2+PGXgBnSpwcs4MeEzvFDDBNDC5Pa4iSsjXfRB3cAFNk0XvSGoJVi80ep1sRrxgMrIt2mF2c0gOW2TI7yCqLBldFmCgdvXKBrLBHwNe6pSNcY31u7QCmnrocPDUqGNQxRZoDnN351qZGOxMrgrRs47+u4T53+eOl7pF47UmsyAf4xgADjpe8R5Jr/QBw7oB37X5/gOl75AGXqBYT5/Th7DzcDgEX3Gfa0sMrq0PMFd6dw1U33OcOdLJogSm9eP0UyD36RHqDdOXbhIPlaxrudFd/LREPzL5/DNbcPP+w3YF4LTSPlK9pSO6OHJj9lQmwk+v5B6lgnr00z/X5wF2bwHoqahdgWmCzqX2bEaAL20d0QaCxESbwQGjCwWpzj4DJgc1PzaPtD0jwswe9CfE4v9W0xx01sJkTGNg8miD875nZXgIwHthcBliz99IpkLk24zRof/b18wsA9oB5r/1LFlDuHfmwGlTyV2IEzDFJGcQqXZ51DNYWGDh7dVESCGzzCdkhYIPbC5h9Fq39ARc45G4+s/ZuJgb3D2twy5GEeqG8U8B4AEh719nr+7ejiT4g7+4VMA6A37mgY/T8hA3QHLM/3vize7jOV1bd8BB3SADumSisPXA/vS6MGqNBgCvMqmoaHuJuYoUAYF7ICrbHVWDNIQfm9XcI4BqzqpqGh7hTNodG9Ehci7DIwPsDdj8hU+5rznjH+eoUMBZAkT1i3ozzv5gE1L4HLVi8pmGBO+8gUWMi5jKd6/Nge0SHx+0PihkDwN4wBY83CjNCTwWQV/UwfI17DR2jEa6bjMGf79P5if4aeLX+ip41IAGYUZRM8xgNNkac+qVX5FFXNxx0V6/Tl4f5knBXCHjn9IFAqFnV/Ik/BmSHJgH8+W6x3r/9yrkrBtyv7HHCaPmtAHuKSAB/vH03Xx+RQXp3DO5ahhKM1uKkNAEY14OLsujOZX696PyfjK1v1ATgZwyeuzAkBuvLYPWk7AVnCGA/urcQg4dBekpyI/133YPd2uxFSPtjdH6EXlq1kEXj3Jm7LS4Tgr1eCaE1nZXC89IE4OX9T1cg7P1KOoCxF68LaqptOAqz0KHtKt91AGt3LzWoB5ev0TSw0KG1WeW7EmC31g2ZB2vwGtmmbHVDjZ8mLRZyL8HX3TIICa6LhoDsyy0sdGivQV8ki9b2FgRI11Srz9OzaHQP1soGmqsAtt0XkmW5T3QUa2OhwyYSFyKMukNglaCcDhi50KFNEo27Ytu5wB1Ym+6u2wGMdqdsg74OYHjOsRqjT4/BJe4u14ExrBbDcwNZNHKhY/oBeGGHjzA3CJSObU0sdMw/udL4jFT5Ukcj06TxR4I3KrfUgT1LBy90XG49o5JsEEav9TXUg0VxLZeBzs+i8QsdorQWt4GfDxi/0CFKy94egL003Mw8WJSUj/f8GHy8O/ZS9nJMrwsdorRsF0ZejmlnoUOUVuHlGJkm9aLCqzGN3NEhyqshwNKDKVSSQ8tCR08quhwjCx0dqWQJX+bBzCWAmYsI8P05moxh+C5Z9LkiSrK+/HiG4RctgE8X4TTp8/2ZYkUBiw4SBWCz0HH79isGuNh3WYELl6DwbBc6bi8C+OwSJJ4N1ud0WACfXILGs1nK+nwXwCeXON+zACYtcb5nAUxa4nzPApi0xPmeBTBpifM9C2DSEud7FjUhAcxcApi5BDBzCWDmEsDMJYCZSwAzlwBmLgHMXAKYuQQwcwlg5iID/FDqyw+g7fTI0wu41O+//VxUkS81lQDXM77J4BVThy0BP5b7xjXmnEFFBfjx3NMHdG9///kDU+rjbbwjzBrnS80loPV8vj+33QdK0DpcCfCxDHcwLl2jzhlURICnO2xvLzBr8zg5rNRjekeINc6XmkuA6/n9x3Bv4ZMAuA5bAlzHx9vrYPSCOY4SEQF2BwzR/QVR6qFex5NojbOlTAlcPUNngtdhSuDqGAAj68CKCvA4UMVe9LDW7e9TAIOWmgAbY0ipaSuunpvnGlwCV8fwsBeyDqyIAE+hBBhQPt6GB8pvr+BS40mwxpBSYwlcPcNbDFB1jCUwdTzGloCrA60WAM9Fvv4kBoyq52FyLHgdyoZP6LEMD/L1CbhguHmGIOohGlHP9BYSTB3+e0vAxzLE+S6H6IKE4Xl80FLIJEsvAUPqmV/5hqjj7r+XBnwsQ0voMslCpfzTkT28WUlGD+Q0adEkIPW4Z7CgdZgS4Dq2hl1Nk3CT9vGgbq/gUg/sQofJooH1/P7D9EZoHa4E+Fhuz2xsZNrlQoe3EAfRTZl3f4BKzQOuNc6XmksA67lPD9EPFsA6vBLgY9kaos4ZUHKxgbkEMHMJYOYSwMwlgJlLADOXAGYuAcxcApi5BDBzCWDmEsDMJYCZSwAzlwBmLgHMXAKYuQQwcwlg5hLAzCWAmUsAM5cAZi4BzFwCmLkEMHMJYOa6HuDN413Vn/dqSgJYADOTAGauJ8+Pt3+/TY9uDg9s/md+THR4RH94vn58gxUbXRTw8EKr59/hvUcPNf9neIh7eCL7Prwnh40uCvjVez3Gbf7B+JT44+t//8lqxL4o4O/jL6y3r4KYwvDI+6YqvyTjZF0a8N0Cnt7AMITlx/w2FS66NOBVDx70+f6vyu8xOlmXBjy/mWr+waj7t/+/c0qirw14TJ5tFj1lW9+rv2vuXF0b8HIePLwrdnx5Fac063qALyYBzFwCmLkEMHMJYOYSwMwlgJlLADOXAGYuAcxcApi5BDBzCWDmEsDMJYCZSwAzlwBmLgHMXAKYuQQwcwlg5hLAzCWAmUsAM9dfVDFWtifoFdwAAAAASUVORK5CYII=" style="display: block; margin: auto;" /></p>
<p>Excellent. We have predictions!</p>
</div>
<div id="step-4b-add-modules-for-prediction" class="section level4">
<h4>Step 4B: Add Modules for Prediction</h4>
<p>We’re now ready to register the prediction function we’ve created.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw">set_pred</span>(</span>
<span id="cb15-2"><a href="#cb15-2"></a>    <span class="dt">model         =</span> <span class="st">&quot;decomposition_reg&quot;</span>,</span>
<span id="cb15-3"><a href="#cb15-3"></a>    <span class="dt">eng           =</span> <span class="st">&quot;stlm_ets&quot;</span>,</span>
<span id="cb15-4"><a href="#cb15-4"></a>    <span class="dt">mode          =</span> <span class="st">&quot;regression&quot;</span>,</span>
<span id="cb15-5"><a href="#cb15-5"></a>    <span class="dt">type          =</span> <span class="st">&quot;numeric&quot;</span>,</span>
<span id="cb15-6"><a href="#cb15-6"></a>    <span class="dt">value         =</span> <span class="kw">list</span>(</span>
<span id="cb15-7"><a href="#cb15-7"></a>        <span class="dt">pre       =</span> <span class="ot">NULL</span>,</span>
<span id="cb15-8"><a href="#cb15-8"></a>        <span class="dt">post      =</span> <span class="ot">NULL</span>,</span>
<span id="cb15-9"><a href="#cb15-9"></a>        <span class="dt">func      =</span> <span class="kw">c</span>(<span class="dt">fun =</span> <span class="st">&quot;predict&quot;</span>),</span>
<span id="cb15-10"><a href="#cb15-10"></a>        <span class="dt">args      =</span></span>
<span id="cb15-11"><a href="#cb15-11"></a>            <span class="kw">list</span>(</span>
<span id="cb15-12"><a href="#cb15-12"></a>                <span class="dt">object   =</span> rlang<span class="op">::</span><span class="kw">expr</span>(object<span class="op">$</span>fit),</span>
<span id="cb15-13"><a href="#cb15-13"></a>                <span class="dt">new_data =</span> rlang<span class="op">::</span><span class="kw">expr</span>(new_data)</span>
<span id="cb15-14"><a href="#cb15-14"></a>            )</span>
<span id="cb15-15"><a href="#cb15-15"></a>    )</span>
<span id="cb15-16"><a href="#cb15-16"></a>)</span>
<span id="cb15-17"><a href="#cb15-17"></a></span>
<span id="cb15-18"><a href="#cb15-18"></a><span class="kw">show_model_info</span>(<span class="st">&quot;decomposition_reg&quot;</span>)</span>
<span id="cb15-19"><a href="#cb15-19"></a><span class="co">#&gt; Information for `decomposition_reg`</span></span>
<span id="cb15-20"><a href="#cb15-20"></a><span class="co">#&gt;  modes: unknown, regression </span></span>
<span id="cb15-21"><a href="#cb15-21"></a><span class="co">#&gt; </span></span>
<span id="cb15-22"><a href="#cb15-22"></a><span class="co">#&gt;  engines: </span></span>
<span id="cb15-23"><a href="#cb15-23"></a><span class="co">#&gt;    regression: stlm_ets</span></span>
<span id="cb15-24"><a href="#cb15-24"></a><span class="co">#&gt; </span></span>
<span id="cb15-25"><a href="#cb15-25"></a><span class="co">#&gt;  arguments: </span></span>
<span id="cb15-26"><a href="#cb15-26"></a><span class="co">#&gt;    stlm_ets: </span></span>
<span id="cb15-27"><a href="#cb15-27"></a><span class="co">#&gt;       period_seasonal_1 --&gt; period_seasonal_1</span></span>
<span id="cb15-28"><a href="#cb15-28"></a><span class="co">#&gt;       period_seasonal_2 --&gt; period_seasonal_2</span></span>
<span id="cb15-29"><a href="#cb15-29"></a><span class="co">#&gt; </span></span>
<span id="cb15-30"><a href="#cb15-30"></a><span class="co">#&gt;  fit modules:</span></span>
<span id="cb15-31"><a href="#cb15-31"></a><span class="co">#&gt;      engine       mode</span></span>
<span id="cb15-32"><a href="#cb15-32"></a><span class="co">#&gt;    stlm_ets regression</span></span>
<span id="cb15-33"><a href="#cb15-33"></a><span class="co">#&gt; </span></span>
<span id="cb15-34"><a href="#cb15-34"></a><span class="co">#&gt;  prediction modules:</span></span>
<span id="cb15-35"><a href="#cb15-35"></a><span class="co">#&gt;          mode   engine methods</span></span>
<span id="cb15-36"><a href="#cb15-36"></a><span class="co">#&gt;    regression stlm_ets numeric</span></span></code></pre></div>
</div>
</div>
<div id="step-5-add-encoding" class="section level3">
<h3>Step 5: Add Encoding</h3>
<p>We need to modify how <code>parnsip</code> handles features because date and date-time information cannot be processed by <code>model.frame()</code> (default behavior). We use <code>set_encoding()</code> to ensure the predictors are processed without any preprocessing. We’ll handle all preprocessing in our fit model bridge, <code>bridge_stlm_ets_fit_impl()</code> (shown next).</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>parsnip<span class="op">::</span><span class="kw">set_encoding</span>(</span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="dt">model   =</span> <span class="st">&quot;decomposition_reg&quot;</span>,</span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="dt">eng     =</span> <span class="st">&quot;stlm_ets&quot;</span>,</span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="dt">mode    =</span> <span class="st">&quot;regression&quot;</span>,</span>
<span id="cb16-5"><a href="#cb16-5"></a>  <span class="dt">options =</span> <span class="kw">list</span>(</span>
<span id="cb16-6"><a href="#cb16-6"></a>    <span class="dt">predictor_indicators =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb16-7"><a href="#cb16-7"></a>    <span class="dt">compute_intercept =</span> <span class="ot">FALSE</span>,</span>
<span id="cb16-8"><a href="#cb16-8"></a>    <span class="dt">remove_intercept =</span> <span class="ot">FALSE</span>,</span>
<span id="cb16-9"><a href="#cb16-9"></a>    <span class="dt">allow_sparse_x =</span> <span class="ot">FALSE</span></span>
<span id="cb16-10"><a href="#cb16-10"></a>  )</span>
<span id="cb16-11"><a href="#cb16-11"></a>)</span></code></pre></div>
</div>
</div>
<div id="does-it-work" class="section level2">
<h2>Does it work?</h2>
<p>The moment of truth is upon us! Let’s test this new <code>modeltime</code> function out.</p>
<div id="make-the-fitted-stl-decomposition-model" class="section level3">
<h3>Make the Fitted STL Decomposition Model</h3>
<p>We’ll split the data into training and test sets.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>splits &lt;-<span class="st"> </span><span class="kw">initial_time_split</span>(taylor_<span class="dv">30</span>_min, <span class="dt">prop =</span> <span class="fl">0.9</span>)</span></code></pre></div>
<p>Then create a model on the training set.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>model_fit &lt;-<span class="st"> </span><span class="kw">decomposition_reg</span>(</span>
<span id="cb18-2"><a href="#cb18-2"></a>    <span class="dt">period_seasonal_1 =</span> <span class="dv">24</span><span class="op">*</span><span class="dv">2</span>, </span>
<span id="cb18-3"><a href="#cb18-3"></a>    <span class="dt">period_seasonal_2 =</span> <span class="dv">24</span><span class="op">*</span><span class="dv">2</span><span class="op">*</span><span class="dv">7</span></span>
<span id="cb18-4"><a href="#cb18-4"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;stlm_ets&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="st">  </span><span class="kw">fit</span>(value <span class="op">~</span><span class="st"> </span>date, <span class="dt">data =</span> <span class="kw">training</span>(splits))</span>
<span id="cb18-7"><a href="#cb18-7"></a></span>
<span id="cb18-8"><a href="#cb18-8"></a>model_fit</span></code></pre></div>
<pre><code>#&gt; parsnip model object
#&gt; 
#&gt; Fit time:  194ms 
#&gt; STLM Model: ETS(M,N,N)
#&gt; ets(y = x, model = etsmodel, allow.multiplicative.trend = allow.multiplicative.trend)
#&gt; 
#&gt; # A tibble: 1 x 5
#&gt;      aic    bic   aicc  loglik    mse
#&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
#&gt; 1 63151. 63170. 63151. -31573. 10019.</code></pre>
</div>
<div id="make-a-calibrated-modeltime-table" class="section level3">
<h3>Make a Calibrated Modeltime Table</h3>
<p>Next, let’s calibrate the fitted model.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>calibration_tbl &lt;-<span class="st"> </span>model_fit <span class="op">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="st">  </span><span class="kw">modeltime_table</span>() <span class="op">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="st">  </span><span class="kw">modeltime_calibrate</span>(<span class="dt">new_data =</span> <span class="kw">testing</span>(splits))</span>
<span id="cb20-4"><a href="#cb20-4"></a></span>
<span id="cb20-5"><a href="#cb20-5"></a>calibration_tbl</span>
<span id="cb20-6"><a href="#cb20-6"></a><span class="co">#&gt; # Modeltime Table</span></span>
<span id="cb20-7"><a href="#cb20-7"></a><span class="co">#&gt; # A tibble: 1 x 5</span></span>
<span id="cb20-8"><a href="#cb20-8"></a><span class="co">#&gt;   .model_id .model   .model_desc            .type .calibration_data </span></span>
<span id="cb20-9"><a href="#cb20-9"></a><span class="co">#&gt;       &lt;int&gt; &lt;list&gt;   &lt;chr&gt;                  &lt;chr&gt; &lt;list&gt;            </span></span>
<span id="cb20-10"><a href="#cb20-10"></a><span class="co">#&gt; 1         1 &lt;fit[+]&gt; STLM MODEL: ETS(M,N,N) Test  &lt;tibble [404 x 4]&gt;</span></span></code></pre></div>
</div>
<div id="refit-on-the-full-dataset" class="section level3">
<h3>Refit on the Full Dataset</h3>
<p>We’ll refit on the full dataset.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>refit_tbl &lt;-<span class="st"> </span>calibration_tbl <span class="op">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="st">  </span><span class="kw">modeltime_refit</span>(<span class="dt">data =</span> taylor_<span class="dv">30</span>_min)</span></code></pre></div>
<p>Then forecast forward 1 week.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>refit_tbl <span class="op">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="st">  </span><span class="kw">modeltime_forecast</span>(<span class="dt">h =</span> <span class="st">&quot;1 week&quot;</span>, <span class="dt">actual_data =</span> taylor_<span class="dv">30</span>_min) <span class="op">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="st">  </span><span class="kw">plot_modeltime_forecast</span>(<span class="dt">.interactive =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" style="display: block; margin: auto;" /></p>
<p>And now you’ve just created a new model. Just wrap it up in a package and you’ve extended <code>parsnip</code> and <code>modeltime</code>. Congrats!</p>
</div>
</div>
<div id="further-resources" class="section level2">
<h2>Further Resources</h2>
<p>I’d recommend looking at the code for <code>parsnip-arima_reg.R</code> and <code>parsnip-arima_reg_data.R</code> to see how this process is implemented inside a package.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
